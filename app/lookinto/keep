const getAllUsersThatHaveToggled = async () => {
  try {
    const allUsersShipToggledArray = [];
    let toggledShipCounts = 0;
    const currentUserEmail = FIREBASE_AUTH.currentUser.email;
    if (!currentUserEmail || !gameRoom) return [];

    //get ALL users in the gameRoom
    getDocs(collection(FIREBASE_DB, "users")).then((userSnapShot) => {
      //loop through all users and get their id and ships
      for (const userDoc of userSnapShot.docs) {
        const uid = userDoc.id;
        //console.log("uid:", JSON.stringify(uid, null, 2));
        const shipsRef = collection(FIREBASE_DB, "users", uid, "ships");
        //console.log("shipsRef:", shipsRef);
        const shipsQuery = query(shipsRef, where("gameRoomId", "==", gameRoom));
        //console.log("shipsQuery:", JSON.stringify(shipsQuery, null, 2));
        onSnapshot(shipsQuery, (shipsSnapshot) => {
          //console.log("shipsSnapshot:", shipsSnapshot);
          shipsSnapshot.forEach((shipDoc) => {
            /*  console.log(
            "looping through shipsSnapshot:",
            JSON.stringify(shipDoc, null, 2)
          ); */
            const shipData = shipDoc.data();
            //console.log("Ship Data:", shipData);
            if (shipData.isToggled) {
              toggledShipCounts++;
            }
            allUsersShipToggledArray.push({
              id: shipDoc.id,
              uid,
              ...shipData,
            });
          });
          setGetAllUsersShipTotals([...allUsersShipToggledArray]);
          console.log("Live Total Ships Toggled:", toggledShipCounts);
        });
      }
    });
  } catch (e) {
    console.error("Error setting up live user ship tracking:", e);
  }
};

const getAllUsersThatHaveToggledPressed = () => {
  getAllUsersThatHaveToggled();
  getAllUsers();
};

//function to get all users EXCEPT current user from firestore
const getAllUsers = async () => {
  try {
    const allUsersShipToggledArray = [];
    let toggledShipCounts = 0;
    const currentUserEmail = FIREBASE_AUTH.currentUser.email;
    if (!currentUserEmail || !gameRoom) return [];

    //get ALL users in the gameRoom
    const userSnapShot = await getDocs(collection(FIREBASE_DB, "users"));
    //loop through all users and get their
    for (const userDoc of userSnapShot.docs) {
      const uid = userDoc.id;
      //console.log("uid:", uid);
      const shipsRef = collection(FIREBASE_DB, "users", uid, "ships");
      const shipsQuery = query(shipsRef, where("gameRoomId", "==", gameRoom));
      const shipsSnapshot = await getDocs(shipsQuery);
      shipsSnapshot.forEach((shipDoc) => {
        const shipData = shipDoc.data();
        if (shipData.isToggled) {
          toggledShipCounts++;
        }
        allUsersShipToggledArray.push({
          id: shipDoc.id,
          uid,
          ...shipData,
        });
      });
    }

    setGetAllUsersShipToggled(allUsersShipToggledArray);
    console.log("Total Ships Toggled:", toggledShipCounts);
    console.log(
      "allUsersShipToggledArray:",
      JSON.stringify(allUsersShipToggledArray, null, 2)
    );
    return {
      allShips: allUsersShipToggledArray,
      toggledCount: toggledShipCounts,
    };
  } catch (e) {
    console.error("Error getting users:", e);
    return {
      allShips: [],
      toggledCount: 0,
    };
  }
};

<TouchableOpacity
  style={{
    borderRadius: 5,
    borderColor: Colors.hud,
    borderWidth: 1,
    padding: 5,
  }}
  onPress={getAllUsersThatHaveToggledPressed}
>
  <Text style={styles.underText}>
    Number of Ships: {getAllUsersShipTotals.length}/
    {getAllUsersShipToggled.length}
  </Text>
</TouchableOpacity>;
